<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mercad√£o Medieval</title>
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Uncial Antiqua', cursive; margin:0; padding:0; background:#f9f4e7; color:#2c1a0c; text-align:center; }
    a { text-decoration:none; color:inherit; }

    header { position:relative; height:400px; overflow:hidden; text-align:center; color:white; }
    header .banner { background-image:url('https://thumbs.dreamstime.com/b/arte-de-d-pixel-do-mercado-medieval-jogos-no-c%C3%A9u-azul-ai-gerou-da-cidade-322131946.jpg'); background-size:cover; background-position:center; width:100%; height:100%; position:absolute; top:0; left:0; z-index:0; filter: brightness(0.6); }
    header h1, header p { position:relative; z-index:1; margin:0; padding-top:50px; text-shadow:2px 2px 5px #00000088; }
    header h1 { font-size:3rem; }
    header p { font-size:1.2rem; }

    nav { background:#5a3d1e; padding:12px; box-shadow:0 2px 10px rgba(0,0,0,0.3); }
    nav a { color:white; margin:0 15px; font-weight:bold; font-size:1.1em; transition:color 0.3s; }
    nav a:hover { color:#f9f4e7; }

    main { max-width:1200px; margin:20px auto; padding:0 15px; }
    section { margin-bottom:40px; }
    section h2 { font-size:2em; margin-bottom:10px; color:#4e2a09; }

    .imagens-mercado { display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-top:20px; }
    .imagens-mercado img { width:32%; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2); transition:transform 0.2s; }
    .imagens-mercado img:hover { transform:scale(1.05); }

    table { width:100%; border-collapse:collapse; margin-top:20px; }
    table, th, td { border:1px solid #5a3d1e; }
    th, td { padding:10px; text-align:center; }
    th { background:#5a3d1e; color:#fff9e6; }

    .card { background:#fff9e6; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.2); margin-top:20px; }
    .lance-btn { background:linear-gradient(#8b5a2b, #5a3d1e); color:#fff9e6; border:none; padding:12px 24px; border-radius:6px; cursor:pointer; margin-top:10px; transition:background 0.3s; }
    .lance-btn:hover { background:linear-gradient(#a86d34, #6e4821); }

    .container { display:flex; justify-content:space-around; flex-wrap:wrap; padding:20px; }
    .player { width:40%; min-width:300px; padding:20px; border:4px solid #5a3d1e; border-radius:12px; background:#fff9e6; box-shadow:0 4px 10px rgba(0,0,0,0.3); margin-bottom:20px; }
    .player h3 { color:#4e2a09; margin-bottom:10px; }
    .inventory { display:none; list-style:none; padding:0; margin-top:10px; background:#f4ebd0; border-radius:8px; border:2px solid #5a3d1e; }
    .inventory li { padding:8px; border-bottom:1px solid #a38356; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.1em; transition:background 0.2s; }
    .inventory li:hover { background-color:#e8dab0; }
    .inventory li.selected { background-color:#d1ffd1; font-weight:bold; border-left:6px solid #2f6b2f; }
    .button { margin-top:15px; padding:12px 24px; background:linear-gradient(#8b5a2b, #5a3d1e); color:#f9f4e7; border:2px solid #3e2610; cursor:pointer; border-radius:6px; font-size:1.1em; box-shadow:0 2px 6px rgba(0,0,0,0.6); transition:transform 0.2s; }
    .button:hover { transform:scale(1.05); background:linear-gradient(#a86d34, #6e4821); }
    .status { margin-top:20px; font-weight:bold; font-size:1.2em; color:#c49b3f; text-shadow:1px 1px 2px #00000033; }
    .item-image { width:40px; height:40px; object-fit:contain; margin-right:10px; }

    footer { background:#5a3d1e; color:white; padding:15px; margin-top:40px; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="banner"></div>
    <h1>‚öîÔ∏è Mercad√£o üõ°Ô∏è</h1>
    <p>Tudo o que voc√™ procura, est√° aqui!</p>
  </header>

  <!-- Nav -->
  <nav>
    <a href="#mercado">üè™ Mercado</a>
    <a href="#tabela">üìä Tabela</a>
    <a href="#leilao">üî® Leil√£o</a>
    <a href="#troca">ü§ù Sala de Troca</a>
    <a href="#contato">üì© Contato</a>
  </nav>

  <main>
    <!-- Mercado -->
    <section id="mercado">
      <h2>Mercado</h2>
      <p>Confira alguns produtos do nosso mercado virtual:</p>
      <div class="imagens-mercado">
        <img src="https://cdn-icons-png.flaticon.com/512/616/616554.png" alt="Espada">
        <img src="https://cdn-icons-png.flaticon.com/512/616/616430.png" alt="Armadura">
        <img src="https://cdn-icons-png.flaticon.com/512/590/590685.png" alt="Po√ß√£o">
      </div>
    </section>

    <!-- Tabela -->
    <section id="tabela">
      <h2>Tabela de Produtos</h2>
      <table>
        <tr><th>Produto</th><th>Pre√ßo</th><th>Estoque</th></tr>
        <tr><td>Espada Lend√°ria</td><td>R$ 500</td><td>10</td></tr>
        <tr><td>Armadura √âpica</td><td>R$ 750</td><td>5</td></tr>
        <tr><td>Po√ß√£o de Cura</td><td>R$ 50</td><td>50</td></tr>
      </table>
    </section>

    <!-- Leil√£o -->
    <section id="leilao">
      <h2>üî® Leil√£o ao Vivo</h2>
      <div class="card">
        <h3>Configurar Novo Leil√£o</h3>
        <input type="text" id="itemLeilao" placeholder="Nome do item">
        <input type="number" id="lanceMinimo" placeholder="Valor m√≠nimo">
        <input type="number" id="tempoInicial" placeholder="Tempo em segundos">
        <button class="lance-btn" onclick="iniciarLeilao()">Iniciar Leil√£o</button>
      </div>
      <div class="card" style="margin-top:20px;">
        <h3>Item em Leil√£o: <span id="itemAtual">Nenhum</span></h3>
        <p>Tempo restante: <span id="timer">0</span> s</p>
        <p>Lance atual: R$ <span id="lanceAtual">0</span></p>
        <p>Usu√°rio atual: <span id="usuarioAtual">Nenhum</span></p>
        <input type="text" id="usuario" placeholder="Seu nome">
        <input type="number" id="lance" placeholder="Digite seu lance">
        <button class="lance-btn" onclick="darLance()">Dar Lance</button>
      </div>
    </section>

    <!-- Sala de Troca -->
    <section id="troca">
      <h2>ü§ù Sala de Troca Medieval</h2>
      <div class="status" id="status">Aguardando jogadores...</div>
      <div class="container">
        <div class="player" id="player1">
          <h3>Jogador 1</h3>
          <button class="button" id="participar1" onclick="participar('player1')">üéØ Participar da Troca</button>
          <button class="button" id="abrir1" onclick="toggleInventory('player1')" style="display:none;">üìú Abrir Invent√°rio</button>
          <ul class="inventory" id="inventory-player1" style="display:none;"></ul>
          <button class="button" id="aprovar1" onclick="approveTrade('player1')" style="display:none;">‚úÖ Aprovar Troca</button>
        </div>
        <div class="player" id="player2">
          <h3>Jogador 2</h3>
          <button class="button" id="participar2" onclick="participar('player2')">üéØ Participar da Troca</button>
          <button class="button" id="abrir2" onclick="toggleInventory('player2')" style="display:none;">üìú Abrir Invent√°rio</button>
          <ul class="inventory" id="inventory-player2" style="display:none;"></ul>
          <button class="button" id="aprovar2" onclick="approveTrade('player2')" style="display:none;">‚úÖ Aprovar Troca</button>
        </div>
      </div>
    </section>

    <!-- Contato -->
    <section id="contato">
      <h2>Contato</h2>
      <p>üì© Envie-nos um e-mail: <strong>contato@mercadaomedieval.com</strong></p>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Mercad√£o Medieval</p>
  </footer>

  <!-- Scripts -->
  <script>
    // ===================== Firebase =====================
    const firebaseConfig = {
      apiKey: "AIzaSyDT0bGAvX7MyLdw3RM8Jskw5T1-2jTnfoE",
      authDomain: "mercadao-6e54a.firebaseapp.com",
      databaseURL: "https://mercadao-6e54a-default-rtdb.firebaseio.com",
      projectId: "mercadao-6e54a",
      storageBucket: "mercadao-6e54a.firebasestorage.app",
      messagingSenderId: "603229319192",
      appId: "1:603229319192:web:dab73e539880e6f328536d",
      measurementId: "G-GBCKDBJ83Q"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ===================== Leil√£o =====================
    function iniciarLeilao() {
      const item = document.getElementById("itemLeilao").value.trim();
      const lanceMinimo = parseFloat(document.getElementById("lanceMinimo").value);
      const tempoInicial = parseInt(document.getElementById("tempoInicial").value);
      if(!item || isNaN(lanceMinimo)|| lanceMinimo<=0 || isNaN(tempoInicial) || tempoInicial<=0){
        alert("Preencha corretamente todos os campos!"); return;
      }
      db.ref("leilao").set({ item, lanceAtual:lanceMinimo, usuarioAtual:"Nenhum", tempoRestante:tempoInicial, ativo:true });
    }
    function darLance() {
      const usuario = document.getElementById("usuario").value.trim();
      const lance = parseFloat(document.getElementById("lance").value);
      if(!usuario || isNaN(lance)) { alert("Preencha corretamente!"); return; }
      db.ref("leilao").once("value").then(snapshot=>{
        const leilao = snapshot.val();
        if(!leilao||!leilao.ativo){ alert("Nenhum leil√£o ativo!"); return; }
        if(lance>leilao.lanceAtual){
          let novoTempo = leilao.tempoRestante;
          if(novoTempo<=20) novoTempo+=10;
          db.ref("leilao").update({ lanceAtual:lance, usuarioAtual:usuario, tempoRestante:novoTempo });
        } else { alert("O lance deve ser maior que o atual!"); }
      });
    }
    db.ref("leilao").on("value", snapshot=>{
      const leilao = snapshot.val();
      if(!leilao) return;
      document.getElementById("itemAtual").textContent=leilao.item;
      document.getElementById("lanceAtual").textContent=leilao.lanceAtual;
      document.getElementById("usuarioAtual").textContent=leilao.usuarioAtual;
      document.getElementById("timer").textContent=leilao.tempoRestante;
      if(leilao.ativo && leilao.tempoRestante<=0){
        alert(`üèÜ Vencedor: ${leilao.usuarioAtual} com R$ ${leilao.lanceAtual}!`);
        db.ref("leilao").update({ ativo:false });
      }
    });
    setInterval(()=>{ db.ref("leilao").transaction(l=>{ if(l&&l.ativo&&l.tempoRestante>0) l.tempoRestante--; return l; }); },1000);

    // ===================== Sala de Troca =====================
    const tradeRef = db.ref("trades/trade1");
    tradeRef.once("value").then(snap=>{
      if(!snap.exists()){
        tradeRef.set({
          player1: { inventory:['Espada Lend√°ria','Escudo de Ferro','Po√ß√£o de Cura'], selected:null, approved:false, joined:false },
          player2: { inventory:['Armadura de Ferro','Machado de Guerra','Po√ß√£o de For√ßa'], selected:null, approved:false, joined:false }
        });
      }
    });

    function getItemImage(item){
      const images={
        'Espada Lend√°ria':'https://cdn-icons-png.flaticon.com/512/616/616554.png',
        'Escudo de Ferro':'https://cdn-icons-png.flaticon.com/512/616/616554.png',
        'Po√ß√£o de Cura':'https://cdn-icons-png.flaticon.com/512/590/590685.png',
        'Armadura de Ferro':'https://cdn-icons-png.flaticon.com/512/616/616430.png',
        'Machado de Guerra':'https://cdn-icons-png.flaticon.com/512/616/616554.png',
        'Po√ß√£o de For√ßa':'https://cdn-icons-png.flaticon.com/512/590/590681.png'
      };
      return images[item]||'https://via.placeholder.com/40';
    }

    function participar(player){
      tradeRef.child(player).update({ joined:true });
      document.getElementById(`participar${player==='player1'?1:2}`).disabled=true;
    }

    function toggleInventory(player){
      const inv=document.getElementById(`inventory-${player}`);
      inv.style.display=inv.style.display==='block'?'none':'block';
    }

    function selectItem(player,item,event){
      tradeRef.once('value').then(snap=>{
        const data=snap.val();
        if(!data) return;
        data[player].selected=item;
        tradeRef.update({ [player]: data[player] });
      });
    }

    function approveTrade(player){
      tradeRef.once('value').then(snap=>{
        const data=snap.val();
        if(!data) return;
        if(!data[player].selected){ alert(`Escolha um item primeiro, ${player}`); return; }
        data[player].approved=true;
        tradeRef.update({ [player]: data[player] });
      });
    }

    function updateInventoryUI(player,data){
      const inv=document.getElementById(`inventory-${player}`);
      inv.innerHTML='';
      data.inventory.forEach(item=>{
        const li=document.createElement('li');
        li.innerHTML=`<img src="${getItemImage(item)}" class="item-image">${item}`;
        li.onclick=(e)=>selectItem(player,item,e);
        if(data.selected===item) li.classList.add('selected');
        inv.appendChild(li);
      });
    }

    function checkParticipationUI(data){
      const p1=data.player1.joined;
      const p2=data.player2.joined;
      document.getElementById('status').textContent=`Jogador1: ${p1?'Entrou':'Aguardando'} | Jogador2: ${p2?'Entrou':'Aguardando'}`;
      if(p1&&p2){
        document.getElementById('abrir1').style.display='inline-block';
        document.getElementById('abrir2').style.display='inline-block';
        document.getElementById('aprovar1').style.display='inline-block';
        document.getElementById('aprovar2').style.display='inline-block';
        document.getElementById('inventory-player1').style.display='block';
        document.getElementById('inventory-player2').style.display='block';
      }
    }

    tradeRef.on('value', snap=>{
      const data=snap.val();
      if(!data) return;
      updateInventoryUI('player1',data.player1);
      updateInventoryUI('player2',data.player2);
      checkParticipationUI(data);

      let statusText='';
      if(data.player1.selected) statusText+=`Jogador1 selecionou: ${data.player1.selected}. `;
      if(data.player2.selected) statusText+=`Jogador2 selecionou: ${data.player2.selected}. `;
      if(data.player1.approved && data.player2.approved) statusText+='Todos aprovaram! ‚úÖ';
      document.getElementById('status').textContent += ' ' + statusText;
    });
  </script>

</body>
</html>
