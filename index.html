<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mercad√£o Medieval</title>
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Uncial Antiqua', cursive; margin:0; padding:0; background:#f9f4e7; color:#2c1a0c; text-align:center; }
    a { text-decoration:none; color:inherit; }
    header { position:relative; height:400px; overflow:hidden; text-align:center; color:white; }
    header .banner { background-image: url('https://thumbs.dreamstime.com/b/arte-de-d-pixel-do-mercado-medieval-jogos-no-c%C3%A9u-azul-ai-gerou-da-cidade-322131946.jpg'); background-size: cover; background-position:center; width:100%; height:100%; position:absolute; top:0; left:0; z-index:0; filter:brightness(0.6); }
    header h1, header p { position:relative; z-index:1; margin:0; padding-top:50px; text-shadow:2px 2px 5px #00000088; }
    header h1 { font-size:3rem; } header p { font-size:1.2rem; }
    nav { background:#5a3d1e; padding:12px; box-shadow:0 2px 10px rgba(0,0,0,0.3); }
    nav a { color:white; margin:0 15px; font-weight:bold; font-size:1.1em; transition:color 0.3s; }
    nav a:hover { color:#f9f4e7; }
    main { max-width:1200px; margin:20px auto; padding:0 15px; }
    section { margin-bottom:40px; }
    section h2 { font-size:2em; margin-bottom:10px; color:#4e2a09; }
    .imagens-mercado { display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-top:20px; }
    .imagens-mercado img { width:32%; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2); transition: transform 0.2s; }
    .imagens-mercado img:hover { transform:scale(1.05); }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    table, th, td { border:1px solid #5a3d1e; }
    th, td { padding:10px; text-align:center; }
    th { background:#5a3d1e; color:#fff9e6; }
    .card { background:#fff9e6; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.2); margin-top:20px; }
    .lance-btn, .button, .trade-btn { background: linear-gradient(#8b5a2b, #5a3d1e); color:#fff9e6; border:none; padding:12px 24px; border-radius:6px; cursor:pointer; margin-top:10px; transition: background 0.3s; }
    .lance-btn:hover, .button:hover, .trade-btn:hover { background: linear-gradient(#a86d34, #6e4821); }
    .container { display:flex; justify-content:space-around; flex-wrap:wrap; padding:20px; }
    .player { width:40%; min-width:300px; padding:20px; border:4px solid #5a3d1e; border-radius:12px; background:#fff9e6; box-shadow:0 4px 10px rgba(0,0,0,0.3); margin-bottom:20px; }
    .player h3 { color:#4e2a09; margin-bottom:10px; }
    .inventory { display:none; list-style-type:none; padding:0; margin-top:10px; background:#f4ebd0; border-radius:8px; border:2px solid #5a3d1e; }
    .inventory li { padding:8px; border-bottom:1px solid #a38356; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.1em; transition: background 0.2s; }
    .inventory li:hover { background-color:#e8dab0; }
    .inventory li.selected { background-color:#d1ffd1; font-weight:bold; border-left:6px solid #2f6b2f; }
    .status { margin-top:20px; font-weight:bold; font-size:1.2em; color:#c49b3f; text-shadow:1px 1px 2px #00000033; }
    .item-image { width:40px; height:40px; object-fit:contain; margin-right:10px; }
    footer { background:#5a3d1e; color:white; padding:15px; margin-top:40px; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <header>
    <div class="banner"></div>
    <h1>‚öîÔ∏è Mercad√£o üõ°Ô∏è</h1>
    <p>Tudo o que voc√™ procura, est√° aqui!</p>
  </header>
  <nav>
    <a href="#mercado">üè™ Mercado</a>
    <a href="#tabela">üìä Tabela</a>
    <a href="#leilao">üî® Leil√£o</a>
    <a href="#troca">ü§ù Sala de Troca</a>
    <a href="#contato">üì© Contato</a>
  </nav>
  <main>
    <!-- Mercado -->
    <section id="mercado">
      <h2>Mercado</h2>
      <p>Confira alguns produtos do nosso mercado virtual:</p>
      <div class="imagens-mercado">
        <img src="https://cdn-icons-png.flaticon.com/512/616/616554.png" alt="Espada">
        <img src="https://cdn-icons-png.flaticon.com/512/616/616430.png" alt="Armadura">
        <img src="https://cdn-icons-png.flaticon.com/512/590/590685.png" alt="Po√ß√£o">
      </div>
    </section>

    <!-- Tabela -->
    <section id="tabela">
      <h2>Tabela de Produtos</h2>
      <table>
        <tr><th>Produto</th><th>Pre√ßo</th><th>Estoque</th></tr>
        <tr><td>Espada Lend√°ria</td><td>R$ 500</td><td>10</td></tr>
        <tr><td>Armadura √âpica</td><td>R$ 750</td><td>5</td></tr>
        <tr><td>Po√ß√£o de Cura</td><td>R$ 50</td><td>50</td></tr>
      </table>
    </section>

    <!-- Leil√£o -->
    <section id="leilao">
      <h2>üî® Leil√£o ao Vivo</h2>
      <div class="card">
        <h3>Configurar Novo Leil√£o</h3>
        <input type="text" id="itemLeilao" placeholder="Nome do item">
        <input type="number" id="lanceMinimo" placeholder="Valor m√≠nimo">
        <input type="number" id="tempoInicial" placeholder="Tempo em segundos">
        <button class="lance-btn" onclick="iniciarLeilao()">Iniciar Leil√£o</button>
      </div>
      <div class="card" style="margin-top:20px;">
        <h3>Item em Leil√£o: <span id="itemAtual">Nenhum</span></h3>
        <p>Tempo restante: <span id="timer">0</span> s</p>
        <p>Lance atual: R$ <span id="lanceAtual">0</span></p>
        <p>Usu√°rio atual: <span id="usuarioAtual">Nenhum</span></p>
        <input type="text" id="usuario" placeholder="Seu nome">
        <input type="number" id="lance" placeholder="Digite seu lance">
        <button class="lance-btn" onclick="darLance()">Dar Lance</button>
      </div>
    </section>

    <!-- Sala de Troca -->
    <section id="troca">
      <h2>ü§ù Sala de Troca Medieval</h2>
      <div class="container">
        <div class="player" id="player1">
          <h3>Jogador 1</h3>
          <button class="trade-btn" onclick="participar('player1')">Participar da Troca</button>
          <button class="trade-btn" onclick="sair('player1')">Sair da Troca</button>
          <button class="trade-btn" onclick="resetTroca()">Resetar Trocas</button>
          <button class="button" onclick="toggleInventory('player1')">üìú Abrir Invent√°rio</button>
          <ul class="inventory" id="inventory-player1"></ul>
          <button class="button" onclick="aprovar('player1')">‚úÖ Aprovar Troca</button>
        </div>
        <div class="player" id="player2">
          <h3>Jogador 2</h3>
          <button class="trade-btn" onclick="participar('player2')">Participar da Troca</button>
          <button class="trade-btn" onclick="sair('player2')">Sair da Troca</button>
          <button class="trade-btn" onclick="resetTroca()">Resetar Trocas</button>
          <button class="button" onclick="toggleInventory('player2')">üìú Abrir Invent√°rio</button>
          <ul class="inventory" id="inventory-player2"></ul>
          <button class="button" onclick="aprovar('player2')">‚úÖ Aprovar Troca</button>
        </div>
      </div>
      <div class="status" id="status"></div>
    </section>

    <!-- Contato -->
    <section id="contato">
      <h2>Contato</h2>
      <p>üì© Envie-nos um e-mail: <strong>contato@mercadaomedieval.com</strong></p>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Mercad√£o Medieval</p>
  </footer>

<script>
  // ===================== Firebase =====================
  const firebaseConfig = {
    apiKey: "AIzaSyDT0bGAvX7MyLdw3RM8Jskw5T1-2jTnfoE",
    authDomain: "mercadao-6e54a.firebaseapp.com",
    databaseURL: "https://mercadao-6e54a-default-rtdb.firebaseio.com",
    projectId: "mercadao-6e54a",
    storageBucket: "mercadao-6e54a.firebasestorage.app",
    messagingSenderId: "603229319192",
    appId: "1:603229319192:web:dab73e539880e6f328536d",
    measurementId: "G-GBCKDBJ83Q"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ===================== Leil√£o =====================
  function iniciarLeilao(){
    const item = document.getElementById("itemLeilao").value.trim();
    const lanceMinimo = parseFloat(document.getElementById("lanceMinimo").value);
    const tempoInicial = parseInt(document.getElementById("tempoInicial").value);
    if(!item||isNaN(lanceMinimo)||lanceMinimo<=0||isNaN(tempoInicial)||tempoInicial<=0){alert("Preencha corretamente!"); return;}
    db.ref("leilao").set({item,lanceAtual:lanceMinimo,usuarioAtual:"Nenhum",tempoRestante:tempoInicial,ativo:true});
  }

  function darLance(){
    const usuario = document.getElementById("usuario").value.trim();
    const lance = parseFloat(document.getElementById("lance").value);
    if(!usuario||isNaN(lance)){alert("Preencha corretamente!"); return;}
    db.ref("leilao").once("value").then(snap=>{
      const leilao = snap.val();
      if(!leilao||!leilao.ativo){alert("Nenhum leil√£o ativo!"); return;}
      if(lance>leilao.lanceAtual){
        let novoTempo = leilao.tempoRestante;
        if(novoTempo<=20) novoTempo+=10;
        db.ref("leilao").update({lanceAtual:lance,usuarioAtual:usuario,tempoRestante:novoTempo});
      }else{alert("O lance deve ser maior que o atual!");}
    });
  }

  db.ref("leilao").on("value",snap=>{
    const leilao = snap.val();
    if(!leilao) return;
    document.getElementById("itemAtual").textContent = leilao.item;
    document.getElementById("lanceAtual").textContent = leilao.lanceAtual;
    document.getElementById("usuarioAtual").textContent = leilao.usuarioAtual;
    document.getElementById("timer").textContent = leilao.tempoRestante;
    if(leilao.ativo && leilao.tempoRestante<=0){
      alert(`üèÜ Vencedor: ${leilao.usuarioAtual} com R$ ${leilao.lanceAtual}!`);
      db.ref("leilao").update({ativo:false});
    }
  });

  setInterval(()=>{
    db.ref("leilao").transaction(l=>{if(l&&l.ativo&&l.tempoRestante>0) l.tempoRestante--; return l;});
  },1000);

  // ===================== Troca em tempo real =====================
  // ===================== Troca em tempo real =====================
const defaultInventories = {
  player1:['Espada Lend√°ria','Escudo de Ferro','Po√ß√£o de Cura'],
  player2:['Armadura de Ferro','Machado de Guerra','Po√ß√£o de For√ßa']
};

const selectedItems = { player1:null, player2:null };
const approved = { player1:false, player2:false };

function getItemImage(item){
  const images = {
    'Espada Lend√°ria':'https://cdn-icons-png.flaticon.com/512/616/616554.png',
    'Escudo de Ferro':'https://cdn-icons-png.flaticon.com/512/616/616554.png',
    'Po√ß√£o de Cura':'https://cdn-icons-png.flaticon.com/512/590/590685.png',
    'Armadura de Ferro':'https://cdn-icons-png.flaticon.com/512/616/616430.png',
    'Machado de Guerra':'https://cdn-icons-png.flaticon.com/512/616/616554.png',
    'Po√ß√£o de For√ßa':'https://cdn-icons-png.flaticon.com/512/590/590681.png'
  };
  return images[item]||'https://via.placeholder.com/40';
}

function updateInventory(player){
  const inv = document.getElementById(`inventory-${player}`);
  db.ref(`trades/trade1/${player}/inventory`).once("value").then(snap=>{
    const items = snap.val()||defaultInventories[player];
    inv.innerHTML='';
    items.forEach(item=>{
      const li = document.createElement('li');
      li.innerHTML = `<img src="${getItemImage(item)}" class="item-image">${item}`;
      li.onclick = e=>selectItem(player,item,e);
      if(selectedItems[player]===item) li.classList.add('selected');
      inv.appendChild(li);
    });
  });
}

function toggleInventory(player){
  const inv = document.getElementById(`inventory-${player}`);
  inv.style.display = inv.style.display==='block'?'none':'block';
}

function selectItem(player,item,event){
  selectedItems[player]=item;
  const lis = document.getElementById(`inventory-${player}`).getElementsByTagName('li');
  for(let li of lis) li.classList.remove('selected');
  event.currentTarget.classList.add('selected');
  db.ref(`trades/trade1/${player}/selected`).set(item);
}

function participar(player){
  db.ref(`trades/trade1/${player}`).update({participando:true});
}

function sair(player){
  db.ref(`trades/trade1/${player}`).update({participando:false,selected:null,approved:false});
}

function aprovar(player){
  db.ref(`trades/trade1/${player}/approved`).set(true);
}

function resetTroca(){
  db.ref('trades/trade1').set({
    player1:{inventory:defaultInventories.player1, selected:null, approved:false, participando:false},
    player2:{inventory:defaultInventories.player2, selected:null, approved:false, participando:false}
  });
}

function updateStatus(trade){
  const s = document.getElementById('status');
  const p1 = trade.player1;
  const p2 = trade.player2;
  let statusText = '';
  statusText += `Jogador 1: ${p1.participando?'‚úÖ entrou':'‚ùå saiu'}, `;
  statusText += `Selecionou: ${p1.selected||'Nada'}, `;
  statusText += `Aprovou: ${p1.approved?'‚úÖ':'‚ùå'}\n`;
  statusText += `Jogador 2: ${p2.participando?'‚úÖ entrou':'‚ùå saiu'}, `;
  statusText += `Selecionou: ${p2.selected||'Nada'}, `;
  statusText += `Aprovou: ${p2.approved?'‚úÖ':'‚ùå'}`;
  s.textContent = statusText;
}

db.ref('trades/trade1').on('value',snap=>{
  const trade = snap.val();
  if(!trade) return;
  ['player1','player2'].forEach(player=>updateInventory(player));
  updateStatus(trade);

  if(trade.player1.selected && trade.player2.selected && trade.player1.approved && trade.player2.approved){
    // Troca realizada
    const temp = trade.player1.selected;
    db.ref('trades/trade1/player1/inventory').once('value').then(snap1=>{
      let inv1 = snap1.val();
      const idx1 = inv1.indexOf(trade.player1.selected);
      if(idx1!==-1) inv1.splice(idx1,1,trade.player2.selected);
      db.ref('trades/trade1/player1/inventory').set(inv1);
    });
    db.ref('trades/trade1/player2/inventory').once('value').then(snap2=>{
      let inv2 = snap2.val();
      const idx2 = inv2.indexOf(trade.player2.selected);
      if(idx2!==-1) inv2.splice(idx2,1,temp);
      db.ref('trades/trade1/player2/inventory').set(inv2);
    });
    db.ref('trades/trade1/player1/selected').set(null);
    db.ref('trades/trade1/player2/selected').set(null);
    db.ref('trades/trade1/player1/approved').set(false);
    db.ref('trades/trade1/player2/approved').set(false);
    document.getElementById('status').textContent='‚úÖ Troca conclu√≠da!';
  }
});

// Inicializar trade
resetTroca();
</script>
</body>
</html>
